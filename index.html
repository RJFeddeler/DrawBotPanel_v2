<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="utf-8">
		<meta name="viewport"   content="width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no" />

		<meta property="og:type"  content="website" />
		<meta property="og:title" content="DrawBot Control Panel" />
		<meta property="og:description" content="Web interface for a CNC style Pen Plotter created by Robert Feddeler" />
		<meta property="og:image" content="http://www.robertfeddeler.com/public/images/mainMenu.png" />
		<meta property="og:url"   content="http://www.robertfeddeler.com/index.html" />

		<title>DrawBot Control Panel</title>

		<!-- 3rd Party Style Sheets (CDN) -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"
			integrity="sha256-HxaKz5E/eBbvhGMNwhWRPrAR9i/lG1JeT4mD6hCQ7s4="
			crossorigin="anonymous" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css" 
			integrity="sha256-tKn8A2U9uuN5rPr3gh4A9FYMJkarrzLVyks7aS/ZfBU=" 
			crossorigin="anonymous" />

		<!-- 3rd Party Style Sheets (Local) -->
		<link rel="stylesheet" type="text/css" href="public/css/nouislider.css" />

		<!-- My Style Sheets -->
		<link rel="stylesheet" type="text/css" href="public/css/general.css" />
		<link rel="stylesheet" type="text/css" href="public/css/animation.css" />

		<!-- Font Awesome 5 -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" 
			integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" 
			crossorigin="anonymous">

	</head>

	<body>
		<!-- Header -->
		<div id="UIHeader" class="flexBar">
			<div id="UIHeaderL"></div>
			<div id="UIHeaderM"></div>
			<div id="UIHeaderR"></div>
		</div>

		<!-- Body -->
		<canvas id="UIMainCanvas" width="0" height="0"></canvas>
		<!-- <div id="UIContent"></div> -->

		<!--Footer-->
		<div id="UIFooter" class="flexBar">
			<div></div>
			<div></div>
			<div></div>
			<input type="hidden" id="idTESTINGzValue" name="zValue" value="1.0">
		</div>

		<!-- 3rd Party Scripts (CDN) -->
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"
			integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
			crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js" 
			integrity="sha256-W9FML0cw6SfScX3k0Z8iTWhaZGSEUrR3R3KWfRA6lnI=" 
			crossorigin="anonymous"></script>

		<!-- 3rd Party Scripts (Local) -->
		<script type="text/javascript" src="public/js/wNumb.js"></script>
		<script type="text/javascript" src="public/js/nouislider.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>

		<!-- System -->
		<script type="text/javascript" src="public/js/System/Clock.js"></script>
		<script type="text/javascript" src="public/js/System/Mouse.js"></script>
		<script type="text/javascript" src="public/js/System/Functions.js"></script>
		<!-- File Formats -->
		<script type="text/javascript" src="public/js/FileFormat/FileLoader.js"></script>
		<script type="text/javascript" src="public/js/FileFormat/ROB.js"></script>
		<script type="text/javascript" src="public/js/FileFormat/SVG.js"></script>
		<script type="text/javascript" src="public/js/FileFormat/IMG.js"></script>
		<!-- Processing -->
		<script type="text/javascript" src="public/js/Processing/Canny.js"></script>
		<!-- Layout -->
		<script type="text/javascript" src="public/js/Layout/MenuList.js"></script>
		<script type="text/javascript" src="public/js/Layout/PanelList.js"></script>
		<script type="text/javascript" src="public/js/Layout/ThemeList.js"></script>
		<!-- UI Shape System -->
		<script type="text/javascript" src="public/js/Shape/Shape.js"></script>
		<script type="text/javascript" src="public/js/Shape/ShapePrototype.js"></script>
		<script type="text/javascript" src="public/js/Shape/ShapeSelector.js"></script>
		<script type="text/javascript" src="public/js/Shape/ShapeInterface.js"></script>
		<script type="text/javascript" src="public/js/Shape/ShapeEffects.js"></script>
		<!-- Shape Modifiers -->
		<script type="text/javascript" src="public/js/Modifiers/Mod.js"></script>
		<script type="text/javascript" src="public/js/Modifiers/Trigger.js"></script>
		<!-- UI Base Components -->
		<script type="text/javascript" src="public/js/Components/UIButton.js"></script>
		<script type="text/javascript" src="public/js/Components/UIPanel.js"></script>
		<!-- UI Form Components -->
		<script type="text/javascript" src="public/js/Form/UIContent.js"></script>
		<script type="text/javascript" src="public/js/Form/UIElement.js"></script>
		<script type="text/javascript" src="public/js/Form/UIAnimation.js"></script>
		<script type="text/javascript" src="public/js/Form/UIRequest.js"></script>
		<script type="text/javascript" src="public/js/Form/UISplit.js"></script>
		<script type="text/javascript" src="public/js/Form/UILightButton.js"></script>
		<script type="text/javascript" src="public/js/Form/UISubmitButton.js"></script>
		<script type="text/javascript" src="public/js/Form/UIWell.js"></script>
		<script type="text/javascript" src="public/js/Form/UICarousel.js"></script>
		<script type="text/javascript" src="public/js/Form/UIContainer.js"></script>
		<script type="text/javascript" src="public/js/Form/UIFile.js"></script>
		<script type="text/javascript" src="public/js/Form/UISpacer.js"></script>
		<script type="text/javascript" src="public/js/Form/UISeparator.js"></script>
		<script type="text/javascript" src="public/js/Form/UIListItem.js"></script>
		<script type="text/javascript" src="public/js/Form/UIBinaryPicker.js"></script>
		<script type="text/javascript" src="public/js/Form/UIMultiPicker.js"></script>
		<script type="text/javascript" src="public/js/Form/UISlidePicker.js"></script>
		<script type="text/javascript" src="public/js/Form/UIToggle.js"></script>
		<script type="text/javascript" src="public/js/Form/UITextBox.js"></script>
		<script type="text/javascript" src="public/js/Form/UINumberBox.js"></script>
		<script type="text/javascript" src="public/js/Form/UIProgress.js"></script>
		<script type="text/javascript" src="public/js/Form/UIStrength.js"></script>
		<script type="text/javascript" src="public/js/Form/UICanvas.js"></script>
		<script type="text/javascript" src="public/js/Form/UISVGPreview.js"></script>
		<!-- Data -->
		<script type="text/javascript" src="public/js/Data/RQGet.js"></script>
		<script type="text/javascript" src="public/js/Data/State.js"></script>

		<script type="text/javascript">
			const refreshRate = 20;
			const marginHeight  = 50;

			RQGet.setState(DrawBotState);

    		var shapeSettings = {
				shape: 'Circle',
				radius: 20,
				border: 2,
				distance: 10
			};

			var startAnimation = {
				name: 'bounce',
				speed: 50,
				direction: 'forwardDiagonal'
			};
      
			var periodicAnimation = {
				speed: 40,
				interval: 4000,
				startDelay: 8000
			};

			var mouse = new Mouse();
			var clock = new Clock(refreshRate);

			var theme = ThemeList.theme('Default');

			var ui  = new ShapeInterface(shapeSettings, theme, marginHeight, windowWidth(), windowHeight());
			var fx  = new ShapeEffects(ui.ctx(), ui.shapes, ui.shape(), ui.rows(), ui.columns(), startAnimation, periodicAnimation);

			//ui.makeBland();

			/*
			var socket = io.connect();

			socket.on('MESSAGE', (data) => {
				console.log(data);
				socket.emit("Received!");
			});

			socket.on('disconnect', () => {
		        socket.open();
		    });
			*/

			document.getElementById('UIHeader').addEventListener('click', function() { socket.emit('click'); });

			(function () {
				var blurred = false;

				function main(tFrame) {
					if (clock.running && !blurred)
						window.requestAnimationFrame(main);

					var nextTick = clock.lastTick + clock.tickLength,
					numTicks = 0;

					if (tFrame > nextTick) {
						var timeSinceTick = tFrame - clock.lastTick;
						numTicks = Math.floor(timeSinceTick / clock.tickLength);
					}

					queueUpdates(numTicks);

					ui.render(tFrame);

					clock.lastRender = tFrame;
				}

				function queueUpdates(numTicks) {
					for(let i = 0; i < numTicks; i++) {
						clock.lastTick += clock.tickLength;

						ui.update(clock.lastTick);
						fx.update(clock.lastTick);
					}
				}

				window.addEventListener('blur',  function() { blurred = true;  }, false);

				window.addEventListener('focus', function() { blurred = false; clock.lastTick = performance.now(); window.requestAnimationFrame(main); }, false);

				ui.showMenu('M.Main', 2000);

				main(performance.now());
			})();

			$(window).resize(function(){
				ui.changeDimensions(windowWidth(), windowHeight());
			});

			DrawBotState.update({
				System_State:0, System_Version: '0.91', Time_Elapsed:0,
				System_DrawSpeed:5, System_TravelSpeed:10, System_PrintAreaWidth:2500, System_PrintAreaHeight:2000,
				Storage_Type:4, Storage_Label:'My Art', Storage_FileCount:31, Storage_Capacity:512, Storage_FreeSpace:256,
				Network_State:3, Network_Mode:1, Network_Protocol:'802.11 N', Network_SSID:'FiOS-0HO18-5G', Network_Signal:60, Network_Security:4,
				Network_IP:'192.168.0.101', Network_DHCP:1, Network_Netmask:'255.255.255.0', Network_Gateway:'192.168.0.1',
				ArmSpec_Left_Stepper1_Range:200, ArmSpec_Left_Stepper1_StepsPerRev:400, ArmSpec_Left_Stepper1_Microstep:32,
				ArmSpec_Left_Stepper2_Range:200, ArmSpec_Left_Stepper2_StepsPerRev:400, ArmSpec_Left_Stepper2_Microstep:32,
				ArmSpec_Left_Servo_Range:200, ArmSpec_Left_Servo_Down:160, ArmSpec_Left_Servo_Up:90,
				ArmSpec_Right_Stepper1_Range:200, ArmSpec_Right_Stepper1_StepsPerRev:400, ArmSpec_Right_Stepper1_Microstep:32,
				ArmSpec_Right_Stepper2_Range:200, ArmSpec_Right_Stepper2_StepsPerRev:400, ArmSpec_Right_Stepper2_Microstep:32,
				ArmSpec_Right_Servo_Range:200, ArmSpec_Right_Servo_Down:160, ArmSpec_Right_Servo_Up:90,
				ArmPosition_Left_X: 0, ArmPosition_Left_Y: 0, ArmPosition_Left_Pen: 2, ArmPosition_Left_LinesDrawn: 0,
				ArmPosition_Right_X: 0, ArmPosition_Right_Y: 0, ArmPosition_Right_Pen: 1, ArmPosition_Right_LinesDrawn: 0,
				PrintPreview_Filename:'', PrintPreview_ScaleX:100, PrintPreview_ScaleY:100, PrintPreview_OffsetX:0, PrintPreview_OffsetY:0
			});
		</script>
	</body>
</html>
